<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>PDF çŸ¥è¯†å›¾è°±ç”Ÿæˆå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 900px; margin: 30px auto; padding: 20px; background-color: #f9f9f9; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; }
        .upload-area { border: 2px dashed #3b82f6; background: #eff6ff; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 20px; }
        button { background-color: #3b82f6; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin-top: 10px; transition: background 0.3s; }
        button:hover { background-color: #2563eb; }

        /* å›¾è¡¨å®¹å™¨å¿…é¡»æœ‰å®½é«˜ */
        #main-chart { width: 100%; height: 500px; border: 1px solid #eee; margin-top: 20px; border-radius: 8px; }

        #text-preview { font-size: 12px; color: #666; margin-top: 10px; height: 60px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
    </style>
</head>
<body>
    <div class="container">
        <h2>ğŸ”® PDF çŸ¥è¯†å›¾è°±ç”Ÿæˆå™¨</h2>

        <div class="upload-area">
            <p>è¯·ä¸Šä¼  PDFï¼Œæˆ‘ä»¬å°†è‡ªåŠ¨æå–å‰ 10 ä¸ªé«˜é¢‘è¯å¹¶ç”Ÿæˆå›¾è°±</p>
            <input type="file" id="pdfFile" accept=".pdf">
            <br>
            <button onclick="uploadAndGenGraph()">ä¸Šä¼ å¹¶ç”Ÿæˆå›¾è°±</button>
        </div>

        <div id="text-preview"></div>
        <div id="main-chart"></div>
    </div>

    <script>
        // åˆå§‹åŒ– ECharts å®ä¾‹
        var myChart = echarts.init(document.getElementById('main-chart'));

        // å®šä¹‰åŸºç¡€é…ç½®
        var option = {
            title: { text: 'æ–‡æ¡£é«˜é¢‘è¯çŸ¥è¯†å›¾è°±' },
            tooltip: {},
            animationDurationUpdate: 1500,
            animationEasingUpdate: 'quinticInOut',
            series: [
                {
                    type: 'graph',
                    layout: 'force',
                    symbolSize: 30,
                    roam: true,
                    label: { show: true, fontSize: 14 },
                    edgeSymbol: ['circle', 'arrow'],
                    edgeSymbolSize: [4, 10],
                    data: [],
                    links: [],
                    categories: [{name: 'æ–‡æ¡£'}, {name: 'å…³é”®è¯'}],
                    force: {
                        repulsion: 300,
                        edgeLength: 100
                    },
                    lineStyle: {
                        color: 'source',
                        curveness: 0.1
                    }
                }
            ]
        };

        myChart.setOption(option);

        // --- ä¿®å¤åçš„ä¸Šä¼ å‡½æ•° ---
        async function uploadAndGenGraph() {
            const fileInput = document.getElementById('pdfFile');
            const previewDiv = document.getElementById('text-preview');

            // 1. è¿™é‡Œçš„åœ°å€é€‰ç”¨äº†ä½ çš„ https ç‰ˆæœ¬ï¼Œæ›´ç¨³å¦¥
            const publicUrl = 'https://61a00b00.r8.cpolar.cn';

            if (fileInput.files.length === 0) {
                alert('ç‰§ï¼Œè¯·å…ˆé€‰æ‹©ä¸€ä¸ª PDF æ–‡ä»¶å“¦ï¼');
                return;
            }

            myChart.showLoading();

            // é‡è¦ï¼šå¿…é¡»æ‰‹åŠ¨åˆ›å»º FormData å¹¶æŠŠæ–‡ä»¶æ”¾è¿›å»
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                // 2. å‘èµ·ç½‘ç»œè¯·æ±‚
                const response = await fetch(`${publicUrl}/upload`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                myChart.hideLoading();

                if (response.ok) {
                    previewDiv.innerText = "æå–æ–‡å­—é¢„è§ˆ: " + data.content;

                    // 3. å°†åç«¯è¿”å›çš„å›¾è°±æ•°æ®å¡«å…¥ ECharts
                    myChart.setOption({
                        series: [{
                            data: data.echarts_data.nodes,
                            links: data.echarts_data.links
                        }]
                    });
                } else {
                    alert('åç«¯æŠ¥é”™å•¦: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                myChart.hideLoading();
                console.error('è¯¦ç»†é”™è¯¯ä¿¡æ¯:', error);
                alert('è¿æ¥å¤±è´¥ï¼è¯·æ£€æŸ¥ï¼š1.ä½ çš„æœ¬åœ° Python æ˜¯å¦æ­£åœ¨è¿è¡Œ 2.Cpolar æ˜¯å¦åœ¨çº¿');
            }
        }

        window.onresize = function() {
            myChart.resize();
        };
    </script>
</body>
</html>